---
title: 设置动态数组公式
description: 如何使用Aspose.Cells库在Microsoft Excel中计算动态数组公式。通过加载现有的Excel文件或创建一个新的Excel文件，我们可以使用Aspose.Cells提供的方法来计算动态数组公式并获得结果。最后，我们将修改后的Excel文件保存到磁盘。
keywords: 动态数组公式，Excel中的动态数组公式，设置动态数组公式，计算动态数组公式，操作Excel的动态数组公式。
type: docs
weight: 70
url: /zh/net/calculation-of-dynamic-array-formulas/
---
## **什么是Excel数组公式**
在Excel中，数组公式是一种特殊类型的公式，允许您对数据数组进行计算，而不是个别单元格。数组公式可用于执行复杂的计算，操作数据和有效地解决特定问题。它们的输入方式与常规公式不同，并且通常需要使用Ctrl + Shift + Enter。

以下是关于Excel数组公式的一些关键点：
1. 语法：
<br>
数组公式的书写方式与常规公式相似，但涉及值的操作。它们用花括号{ }括起来，以表示它们是数组公式。但是，您不需要自己输入这些花括号；在正确输入公式后，Excel会自动添加它们。
1. 输入数组公式：
<br>
要输入数组公式，您将公式输入到公式栏中。然后按Ctrl + Shift + Enter，而不是按Enter键，以完成输入。这会告诉Excel这是一个数组公式。输入正确后，Excel会在公式栏中显示用花括号括起来的公式，以表示它是数组公式。
1. 使用案例：
<br>
数组公式适用于同时在多个单元格或范围内执行计算。它们可用于进行高级数学计算，条件操作，数据过滤等。
1. 优势：
<br>
数组公式允许您在单个公式中执行复杂的计算，这可以提高效率并简化您的工作表。它们能处理大型数据集，并执行通常需要多个中间步骤才能完成的计算。
1. 限制：
<br>
数组公式可能比常规公式更难理解和排除故障。特别是在大量使用或处理大型数据集时，它们可能会拖慢工作表的性能。
1. 示例：
<br>
求范围内值的总和：**{=SUM(A1:A5*B1:B5)}**
<br>
查找范围内的最大值：**{=MAX(A1:A5+B1:B5)}**
<br>
<image src="1.png" width="70%" />
<br>

请记住，应谨慎使用数组公式，并在实施它们之前了解其工作原理。它们是Excel中用于数据分析和操作的强大工具。

## **什么是Excel动态数组公式**
动态数组公式是Excel 365和Excel 2021中引入的新功能。它们使您能够比传统的数组公式更无缝和高效地处理数据数组。动态数组公式会自动将结果溢出到相邻单元格中，从而无需使用Ctrl + Shift + Enter，并且更容易操作数据。

关于Excel动态数组公式的一些关键点：
1. 自动溢出：
<br>
动态数组公式会根据输出数据的大小自动将结果溢出到相邻单元格中。这意味着您不需要在输入公式之前选择单元格范围，也不需要使用Ctrl + Shift + Enter来确认公式。
1. 单元格输入:
<br>
动态数组公式输入到单个单元格中，Excel会自动填充相邻单元格的结果。这使得管理和理解公式变得更容易，因为您只需要输入一次公式。
1. 新功能:
<br>
动态数组公式引入了能够原生处理数组的新函数，如**FILTER**，**SORT**，**UNIQUE**，**SEQUENCE**，**SORTBY**和**RANDARRAY**。这些函数可以返回多个值或直接操作数组，简化了复杂的计算。
1. 灵活的范围处理:
<br>
动态数组公式会根据输入数据的大小或计算结果动态调整溢出范围的大小。这种灵活性能够更有效地利用工作表空间，并简化公式的创建。
1. 改进的性能:
<br>
与传统数组公式相比，动态数组公式可以提高性能，特别是在处理大型数据集或复杂计算时。
1. 兼容性:
<br>
动态数组公式适用于Excel 365和Excel 2021。它们可能不受较旧版本的Excel支持。
1. 动态数组公式的示例:
<br>
**FILTER**：返回满足指定条件的值数组。
<br>
**SORT**：对范围或数组中的值进行排序。
<br>
**UNIQUE**：从列表或范围返回唯一值。
<br>
**SEQUENCE**：生成一系列数字或日期。
<br>
**RANDARRAY**：生成随机数数组。
<br>
<image src="2.png" width="70%" />
<br>

动态数组公式在Excel中为数据操作和分析提供了强大的功能，使得更容易处理数据数组和高效地进行复杂计算。

## **Excel中数组公式和动态数组公式的区别是什么**
在Excel中，数组公式和动态数组公式都用于同时计算多个值，但它们在功能和实现方式上有一些区别。

### **数组公式功能**
1. 数组公式是Excel中传统的公式，可以对数据数组执行计算。
1. 在输入公式后按下Ctrl + Shift + Enter，告诉Excel这是一个数组公式。
1. 数组公式在将结果溢出到相邻单元格方面存在限制。它们通常返回单一结果，尽管该结果可能是单元格数组。
1. 这些公式已经存在很长时间，且受到Excel所有版本的支持。

### **动态数组公式功能**
1. 动态数组公式是Excel 365（Office 365订阅）和Excel 2021中引入的新功能。
1. 这些公式会根据输入数据的大小或计算结果自动将结果溢出到相邻单元格。
1. 动态数组公式不需要按下Ctrl + Shift + Enter；您只需在一个单元格中输入公式，Excel会自动填充相邻单元格的结果。
1. 这些公式能够直接返回多个结果（单元格范围），无需使用数组公式或Ctrl + Shift + Enter。
1. 它们具有新的函数，如**FILTER**，**SORT**，**UNIQUE**等，能够原生处理数组并以动态数组格式返回结果。
总结一下，Excel中的动态数组公式是一种更现代化和方便的处理数组的方式，提供了结果的自动溢出并简化了与传统数组公式相比处理数组的过程。但是，这些功能只在支持动态数组的较新版本的Excel中可用。

## **如何在Excel中设置和计算动态数组公式**
在Excel中设置动态数组公式涉及使用特定的函数，这些函数旨在处理数据数组并允许结果自动溢出到相邻单元格。 

以下是设置动态数组公式的逐步指南：
1. 选择单元格：
<br>
选择要动态数组公式结果出现的单元格。动态数组公式会将结果溢出到相邻单元格，因此确保有足够的空间容纳溢出输出。
1. 输入公式：
<br>
在选定单元格的公式栏中键入动态数组公式。使用Excel 365和Excel 2021中可用的动态数组函数之一，例如**FILTER**、**SORT**、**UNIQUE**、**SEQUENCE**、**SORTBY**或**RANDARRAY**。 
<br>
例如，您可以使用FILTER函数根据特定条件过滤数据列表：**=FILTER(A2:C15,(A2:A15=F4)*(C2:C15=G4),"")**。
<br>
<image src="3.png" width="70%" />
<br>
1. 按Enter键：
<br>
输入公式后，只需在键盘上按Enter键。与传统数组公式不同，您无需按Ctrl + Shift + Enter。
1. 观察溢出范围：
<br>
Excel会自动将公式结果溢出到相邻单元格。溢出范围根据输出数据的大小或公式执行的计算动态调整。Excel通过边框和对角箭头图标突出显示溢出范围，以指示其包含溢出数据。
1. 与溢出范围交互：
<br>
您可以像处理Excel中的其他单元格范围一样与溢出范围进行交互。使用溢出范围运算其他公式，在其上执行计算、对其进行格式化，或在图表或表格中引用它。
1. 更新公式：
<br>
如果需要修改动态数组公式，只需编辑原始单元格中的公式。
编辑后再次按Enter确认更改。如果需要，Excel会自动更新溢出范围。
1. 清除溢出范围：
<br>
如果要清除溢出的数据，可以从原始单元格中删除公式。Excel也会清除溢出范围。或者，您可以直接选择溢出范围，然后按Delete键删除。
<br>

通过遵循这些步骤，您可以在Excel中设置动态数组公式，以便有效地分析和操作数据数组，从而更轻松地进行数据分析和报告任务。

## **如何使用Aspose.Cells设置和刷新动态数组公式**
请参阅以下示例代码，该代码加载包含一些虚拟数据的[示例Excel文件](dynamicArrayFormula.xlsx)。加载文件后，在调用 [Cell.SetDynamicArrayFormula](https://reference.aspose.com/cells/net/aspose.cells/cell/setdynamicarrayformula/#setdynamicarrayformula)函数设置动态数组公式和调用[Workbook.RefreshDynamicArrayFormulas](https://reference.aspose.com/cells/net/aspose.cells/workbook/refreshdynamicarrayformulas/#refreshdynamicarrayformulas)函数刷新动态数组公式之前，调用公式计算，并最后将工作簿保存为[输出Excel文件](out.xlsx)。 

{{< gist "aspose-cells-gists" "59a1901d62ea9ceb08456a818431a898" "Formulas-dynamic-array-formulas.cs" >}}

输出快照：
<br>
<image src="4.png" width="70%" />
